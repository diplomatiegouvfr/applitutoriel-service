<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="secteur">

	<resultMap type="fr.gouv.diplomatie.applitutoriel.business.bo.Secteur" id="mapSecteur">
		<result column="ID_SECTEUR" property="id" />
		<result column="SEC_NOM" property="nom" />
		<result column="SEC_DESCR" property="desc" />
		<result column="SEC_DATE_CREAT" property="dateCreat" />
		<result column="SEC_AUTEUR_CREAT" property="auteurCreat" />
		<result column="SEC_DATE_MAJ" property="dateMajEnreg" />
		<result column="SEC_AUTEUR_MAJ" property="auteurMajEnreg" />
		<result column="SEC_DATE_SUPPR" property="dateSupprEnreg" />
		<result column="SEC_AUTEUR_SUPPR" property="auteurSupprEnreg" />
	</resultMap>

	<sql id="select_fragment">
		SELECT ID_SECTEUR, SEC_NOM, SEC_DESCR, SEC_DATE_CREAT, SEC_AUTEUR_CREAT, SEC_DATE_MAJ, SEC_AUTEUR_MAJ, SEC_DATE_SUPPR,
		SEC_AUTEUR_SUPPR
		FROM SECTEUR
	</sql>

	<select id="select" resultMap="mapSecteur">
		<include refid="select_fragment" />
		WHERE SEC_DATE_SUPPR IS NULL
		ORDER BY SEC_NOM ASC;
	</select>

	<select id="selectById" resultMap="mapSecteur">
		<include refid="select_fragment" />
		WHERE ID_SECTEUR = #{id};
	</select>

	<select id="selectByIdAndAuteur" resultMap="mapSecteur">
		<include refid="select_fragment" />
		WHERE ID_SECTEUR = #{id} AND SEC_AUTEUR_CREAT = #{auteur};
	</select>

	<insert id="insert" parameterType="fr.gouv.diplomatie.applitutoriel.business.bo.Secteur">
		INSERT INTO SECTEUR (
		SEC_NOM,
		SEC_DESCR,
		SEC_DATE_CREAT,
		SEC_AUTEUR_CREAT,
		SEC_DATE_MAJ,
		SEC_AUTEUR_MAJ
		) VALUES (
		#{nom},
		#{desc},
		#{dateCreat},
		#{auteurCreat},
		#{dateMajEnreg},
		#{auteurMajEnreg}
		);
		<selectKey keyProperty="id" resultType="java.lang.Long">
			call IDENTITY()
		</selectKey>
	</insert>

	<update id="update" parameterType="fr.gouv.diplomatie.applitutoriel.business.bo.Secteur">
		UPDATE SECTEUR set SEC_NOM = #{nom}, SEC_DESCR = #{desc}, SEC_DATE_MAJ = #{dateMajEnreg}, SEC_AUTEUR_MAJ =
		#{auteurMajEnreg}, SEC_DATE_SUPPR = #{dateSupprEnreg}, SEC_AUTEUR_SUPPR = #{auteurSupprEnreg} WHERE ID_SECTEUR = #{id}
	</update>

	<select id="selectByNomAndDescExceptForId" resultMap="mapSecteur">
		<include refid="select_fragment" />
		WHERE SEC_DATE_SUPPR IS NULL
		<if test="nom != null and nom != ''">
			AND UPPER(SEC_NOM) LIKE UPPER(#{nom})
		</if>
		<if test="desc != null and desc != ''">
			AND UPPER(SEC_DESCR) LIKE UPPER(#{desc})
		</if>
		<if test="id != null and id != ''">
			AND ID_SECTEUR != #{id}
		</if>
	</select>
</mapper>