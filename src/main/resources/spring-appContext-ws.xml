<?xml version="1.0" encoding="UTF-8"?>

<!-- 
Configuration Spring pour l'appel au WebService (WS)
-->

<beans xmlns="http://www.springframework.org/schema/beans"
	     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	     xmlns:tx="http://www.springframework.org/schema/tx"
	     xmlns:context="http://www.springframework.org/schema/context"
	     xmlns:util="http://www.springframework.org/schema/util"
	     xsi:schemaLocation="
	     	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd
          	http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-4.1.xsd
          	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.1.xsd
          	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.1.xsd
          	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.1.xsd">

	<context:property-placeholder location="classpath:webservices.properties" order="1" ignore-unresolvable="true"/>
	
    <bean id="sslSocketFactory" class="javax.net.ssl.SSLSocketFactory" lazy-init="true" factory-bean="sslSocketSpringFactory"
        factory-method="getObject">
    </bean>

    <bean id="sslSocketSpringFactory" class="hornet.framework.webservice.SSLSocketSpringFactoryWithTrustStore">
    	<!-- parametres pour le KeyStore -->
		<constructor-arg value="${applitutoriel.keyStore}"></constructor-arg>			<!-- Emplacement du KeyStore contenant le certificat client -->
		<constructor-arg value="${applitutoriel.keyStorePassword}"></constructor-arg>	<!-- Mot du passe du KeyStore -->
		<constructor-arg value="${applitutoriel.aliasCertificat}"></constructor-arg>	<!-- Alias du certificat client devant être utilisé -->
		<constructor-arg value="${applitutoriel.algoKeyStore}"></constructor-arg>		<!-- Algorithme utilisé pour gérer le KeyStore -->
		<constructor-arg value="${applitutoriel.typeKeyStore}"></constructor-arg>		<!-- Format de stockage du KeyStore -->
		<!-- parametres pour le TrustStore -->
		<constructor-arg value="${applitutoriel.trustStore}"></constructor-arg>			<!-- Emplacement du TrustStore contenant les certificats de confiance -->
		<constructor-arg value="${applitutoriel.trustStorePassword}"></constructor-arg>	<!-- Mot du passe du TrustStore -->
		<constructor-arg value="${applitutoriel.typeTrustStore}"></constructor-arg>		<!-- Format de stockage du TrustStore -->
		<constructor-arg value="${applitutoriel.algoTrustStore}"></constructor-arg>		<!-- Algorithme utilisé pour gérer le truststore -->
    </bean>    

    <bean id="wsFactory" class="fr.gouv.diplomatie.applitutoriel.ws.factory.WebServiceFactory">
        <constructor-arg ref="wsCallerHelper" />
    </bean>
	
	<!-- Gestion Multipart pour uploader des fichiers class="org.springframework.web.multipart.commons.CommonsMultipartResolver"-->
	<bean id="multipartResolver"
        class="org.springframework.web.multipart.support.StandardServletMultipartResolver">
	</bean>
 	
    <bean id="wsCallerHelper" class="hornet.framework.webservice.WsCallerHelper">
    </bean>

    <bean id="wsHelloService"
        factory-bean="wsHelloServiceClient" factory-method="getHelloServicePort" scope="prototype" >
    </bean>
    
    <bean id="wsHelloServiceClient" class="fr.gouv.diplomatie.applitutoriel.ws.hello.HelloService">
    </bean>
    
    <bean id="wsHelloServiceContextMap" class="java.util.HashMap">
        <constructor-arg>
            <map>
                <entry value="${applitutoriel.HelloService.endpoint}">
                    <key>
                        <util:constant static-field="javax.xml.ws.BindingProvider.ENDPOINT_ADDRESS_PROPERTY" />
                    </key>
                </entry>
                <entry value-ref="sslSocketFactory">
                    <key>
                        <util:constant static-field="com.sun.xml.internal.ws.developer.JAXWSProperties.SSL_SOCKET_FACTORY" />
                    </key>
                </entry>
            </map>
        </constructor-arg>    
    </bean>

</beans>